<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Paulinos spinta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Cropper.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
  <style>
    :root {
      --pastel-green: #d7fbe8;
      --outline: #3d6652;
      --highlight: #b2e5c8;
    }
    body {
      margin: 0; padding: 0;
      min-height: 100vh;
      background: var(--pastel-green);
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #29443a;
    }
    header {
      text-align: center;
      padding: 32px 0 12px 0;
      font-size: 2.5rem;
      font-weight: bold;
      letter-spacing: 2px;
      background: transparent;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      gap: 32px;
      min-height: 400px;
    }
    .sidebars-wrap {
      display: flex;
      flex-direction: column;
      gap: 24px;
      min-width: 210px;
      max-width: 240px;
    }
    .sidebar,
    .uploadbar {
      display: flex;
      flex-direction: column;
      gap: 18px;
      background: rgba(255,255,255,0.45);
      border-radius: 18px;
      padding: 20px 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.05);
      align-self: flex-start;
      width: 100%;
      max-width: 240px;
    }
    .sidebar button,
    .uploadbar button {
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      background: var(--highlight);
      color: #29443a;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.18s;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .sidebar button:hover, .sidebar button:focus,
    .uploadbar button:hover, .uploadbar button:focus {
      background: #b2e7c9;
      outline: 2px solid #3d6652;
    }
    .preset-list {
      margin-top: 7px;
      list-style: none;
      padding: 0;
      max-height: 120px;
      overflow-y: auto;
    }
    .preset-list li {
      background: #e8fff3;
      margin-bottom: 4px;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.98rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }
    .preset-list li:hover {
      background: #c5ecd7;
    }
    .preset-action-btn {
      background: none;
      border: none;
      color: #3d6652;
      font-size: 1.1em;
      cursor: pointer;
      padding: 0 5px;
      transition: color 0.15s;
      border-radius: 3px;
      margin-left: 6px;
    }
    .preset-action-btn:hover {
      color: #ce3b3b;
      background: #fbe8e8;
    }
    .uploadbar label {
      font-weight: bold;
      margin-bottom: 4px;
    }
    input[type="file"] { display: none; }

    .human-container {
      position: relative;
      width: 320px;
      min-height: 700px;
      margin: 0 auto;
      background: none;
    }
    .body-outline {
      position: absolute;
      left: 0; top: 0;
      pointer-events: none;
      z-index: 0;
    }
    .part-img {
      position: absolute;
      z-index: 2;
      box-shadow: 0 2px 16px 2px rgba(0,0,0,0.06);
      background: #fff;
      /* Will be sized/positioned in JS */
      object-fit: cover;
    }
    /* Transparent, visible overlay part buttons for clothing selection */
    .part-btn {
      position: absolute;
      background: rgba(220, 255, 241, 0.28);
      border: 2px dashed #6fdca2;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      z-index: 3;
      outline: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4em;
      color: #3d6652;
      opacity: 0.88;
    }
    .part-btn:focus {
      border-color: #3d6652;
      background: rgba(104, 194, 141, 0.18);
    }
    .part-btn:hover {
      background: rgba(104, 194, 141, 0.13);
      border-color: #3d6652;
    }
    .btn-head { left: 140px; top: 32px; width: 80px; height: 80px; border-radius: 50%; }
    .btn-upper { left: 48px; top: 120px; width: 180px; height: 130px; border-radius: 65px; }
    .btn-legs { left: 68px; top: 320px; width: 143px; height: 230px; border-radius: 32px; }
    .btn-feet { left: 87px; top: 565px; width: 120px; height: 70px; border-radius: 35px; }

    .outfit-label {
      pointer-events: none;
      font-size: 1rem;
      color: #29443a;
      box-shadow: 0 1px 4px rgba(60,60,60,0.08);
      font-weight: bold;
      background: rgba(255,255,255,0.68);
      border-radius: 6px;
      position: absolute;
      width: 90px;
      text-align: center;
      left: 50%;
      transform: translateX(-50%);
      z-index: 6;
      padding: 2px 0;
      user-select: none;
    }
    .label-head { top: 90px;}
    .label-upper { top: 240px;}
    .label-legs { top: 550px;}
    .label-feet { top: 635px;}

    /* Cropper Modal */
    #cropModal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    #cropModalContent {
      background: #fff;
      padding: 18px 18px 12px 18px;
      border-radius: 14px;
      box-shadow: 0 2px 40px 0 rgba(0,0,0,0.23);
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 95vw;
      max-height: 85vh;
    }
    #cropImg {
      max-width: 70vw;
      max-height: 55vh;
      margin-bottom: 12px;
      border-radius: 10px;
      background: #eee;
    }
    #cropModalContent button {
      margin: 0 6px;
    }
    @media (max-width: 900px) {
      main {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        min-height: unset;
      }
      .sidebars-wrap {
        flex-direction: row;
        width: 100vw;
        max-width: 100vw;
        gap: 6vw;
        justify-content: space-around;
        min-width: unset;
        max-width: unset;
      }
      .sidebar, .uploadbar {
        min-width: unset;
        width: 48vw;
        max-width: 48vw;
        padding: 13px 2vw;
      }
      .human-container {
        width: 98vw;
        min-height: 440px;
        max-width: 350px;
      }
      .body-outline { width: 100% !important; height: auto !important; }
      .outfit-label,
      .part-img,
      .btn-head,
      .btn-upper,
      .btn-legs,
      .btn-feet {
        transform: scale(0.85) translateX(-58%);
        left: 58%;
      }
      .preset-list {
        max-height: 60px;
      }
      #cropImg {
        max-width: 95vw;
        max-height: 40vh;
      }
    }
  </style>
</head>
<body>
  <header>
    Paulinos spinta
  </header>
  <main>
    <div class="sidebars-wrap">
      <div class="uploadbar">
        <label>Upload photos:</label>
        <button onclick="triggerFile('head')" title="Upload photo for head">📷 Head</button>
        <input type="file" accept="image/*" id="file-head" onchange="handlePhoto('head')">
        <button onclick="triggerFile('upper')" title="Upload photo for upper body">📷 Upper</button>
        <input type="file" accept="image/*" id="file-upper" onchange="handlePhoto('upper')">
        <button onclick="triggerFile('legs')" title="Upload photo for legs">📷 Legs</button>
        <input type="file" accept="image/*" id="file-legs" onchange="handlePhoto('legs')">
        <button onclick="triggerFile('feet')" title="Upload photo for feet">📷 Feet</button>
        <input type="file" accept="image/*" id="file-feet" onchange="handlePhoto('feet')">
      </div>
      <div class="sidebar">
        <button onclick="randomizeOutfit()" aria-label="Randomize outfit">🎲 Randomize</button>
        <button onclick="savePreset()" aria-label="Save current outfit as preset">💾 Save Preset</button>
        <label style="margin-bottom:0.3em;">Preset Library:</label>
        <ul class="preset-list" id="presetList"></ul>
      </div>
    </div>
    <div class="human-container">
      <!-- SVG Outline for reference -->
      <svg class="body-outline" width="320" height="720" viewBox="0 0 320 720">
        <ellipse cx="180" cy="70" rx="48" ry="48" stroke="#3d6652" stroke-width="5" fill="none"/>
        <rect x="70" y="120" width="180" height="130" rx="65" stroke="#3d6652" stroke-width="5" fill="none"/>
        <rect x="68" y="320" width="143" height="230" rx="32" stroke="#3d6652" stroke-width="5" fill="none"/>
        <ellipse cx="147" cy="600" rx="60" ry="35" stroke="#3d6652" stroke-width="5" fill="none"/>
      </svg>
      <img id="img-head"  class="part-img" src="" alt="Head" hidden>
      <img id="img-upper" class="part-img" src="" alt="Upper Body" hidden>
      <img id="img-legs"  class="part-img" src="" alt="Legs" hidden>
      <img id="img-feet"  class="part-img" src="" alt="Feet" hidden>
      <!-- Transparent, but visible, buttons for each body part -->
      <button class="part-btn btn-head" aria-label="Choose hat or headwear" title="Choose hat or headwear" onclick="choosePart('head')">👒</button>
      <button class="part-btn btn-upper" aria-label="Choose shirt or dress" title="Choose shirt or dress" onclick="choosePart('upper')">👕</button>
      <button class="part-btn btn-legs" aria-label="Choose pants or skirt" title="Choose pants or skirt" onclick="choosePart('legs')">👖</button>
      <button class="part-btn btn-feet" aria-label="Choose shoes" title="Choose shoes" onclick="choosePart('feet')">👟</button>
    </div>
    <!-- Cropper Modal -->
    <div id="cropModal">
      <div id="cropModalContent">
        <div style="font-weight:bold; margin-bottom:10px;">Crop image to fit the body part</div>
        <img id="cropImg" src="" alt="Crop area">
        <div style="margin-top:8px;">
          <button id="cropSaveBtn">Save Crop</button>
          <button onclick="closeCropModal()">Cancel</button>
        </div>
      </div>
    </div>
  </main>
  <footer>
    Spinta atnaujinta 2025-08-11
  </footer>
  <!-- Cropper.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script>
    // SVG part dimensions/positions (should match your SVG and CSS)
    const PARTS = {
      head:  { left: 140, top: 32, width: 80, height: 80, aspect: 1,   shape: "ellipse" },
      upper: { left: 48,  top: 120, width: 180, height: 130, aspect: 180/130, shape: "rect" },
      legs:  { left: 68,  top: 320, width: 143, height: 230, aspect: 143/230, shape: "rect" },
      feet:  { left: 87,  top: 565, width: 120, height: 70,  aspect: 120/70,  shape: "ellipse" }
    };

    let outfit = { head: null, upper: null, legs: null, feet: null };
    let outfitPhotos = { head: null, upper: null, legs: null, feet: null };
    let presets = [];

    // --- Cropper.js logic ---
    let currentCropPart = null;
    let cropper = null;

    function triggerFile(part) {
      document.getElementById('file-' + part).click();
    }

    function handlePhoto(part) {
      const input = document.getElementById('file-' + part);
      const file = input.files && input.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file!');
        return;
      }
      if (file.size > 7 * 1024 * 1024) {
        alert('Image too large! Max size: 7MB');
        return;
      }
      currentCropPart = part;
      const reader = new FileReader();
      reader.onload = function(e) {
        showCropModal(e.target.result, part);
      }
      reader.readAsDataURL(file);
    }

    function showCropModal(dataURL, part) {
      const cropModal = document.getElementById('cropModal');
      const cropImg = document.getElementById('cropImg');
      cropImg.src = dataURL;
      cropModal.style.display = 'flex';

      if (cropper) cropper.destroy();
      // Set aspect ratio per part
      cropper = new Cropper(cropImg, {
        aspectRatio: PARTS[part].aspect,
        viewMode: 1,
        movable: true,
        zoomable: true,
        scalable: true,
        rotatable: false,
        dragMode: 'move',
        responsive: true,
        autoCropArea: 1
      });

      document.getElementById('cropSaveBtn').onclick = () => saveCrop(part);
    }

    function closeCropModal() {
      document.getElementById('cropModal').style.display = 'none';
      if (cropper) cropper.destroy();
      cropper = null;
      currentCropPart = null;
    }

    function saveCrop(part) {
      const dims = PARTS[part];
      // Get cropped image, at SVG part's display size
      const croppedDataURL = cropper.getCroppedCanvas({
        width: dims.width,
        height: dims.height
      }).toDataURL('image/png');
      outfitPhotos[part] = croppedDataURL;
      closeCropModal();
      displayPhotos();
    }

    function displayPhotos() {
      for (const part in PARTS) {
        const img = document.getElementById('img-' + part);
        const dims = PARTS[part];
        if (outfitPhotos[part]) {
          img.src = outfitPhotos[part];
          img.hidden = false;
          img.style.left = dims.left + 'px';
          img.style.top = dims.top + 'px';
          img.style.width = dims.width + 'px';
          img.style.height = dims.height + 'px';
          img.style.borderRadius = (dims.shape === "ellipse" ? "50%" : "16px");
          img.style.clipPath = (dims.shape === "ellipse"
            ? `ellipse(50% 50% at 50% 50%)`
            : "none");
        } else {
          img.hidden = true;
        }
      }
    }

    // --- Presets, outfit, etc ---
    function loadPresets() {
      try {
        const data = localStorage.getItem('presets');
        if (data) {
          presets = JSON.parse(data);
        }
      } catch (e) {
        presets = [];
      }
    }
    function persistPresets() {
      localStorage.setItem('presets', JSON.stringify(presets));
    }
    const partOptions = {
      head: ['Cap', 'Hat', 'Bandana', 'Nothing'],
      upper: ['T-shirt', 'Jacket', 'Dress', 'Sweater', 'Shirt'],
      legs: ['Jeans', 'Skirt', 'Shorts', 'Trousers'],
      feet: ['Sneakers', 'Boots', 'Sandals', 'Dress shoes']
    };
    function choosePart(part) {
      let options = partOptions[part] || [];
      let msg = `Choose for ${part}:\n`;
      options.forEach((opt, idx) => { msg += `${idx + 1}. ${opt}\n`; });
      let choice = prompt(msg, outfit[part] || "");
      if (!choice) return;
      let idx = Number(choice) - 1;
      if (!isNaN(idx) && idx >= 0 && idx < options.length) {
        outfit[part] = options[idx];
      } else if (options.includes(choice)) {
        outfit[part] = choice;
      } else {
        alert("Not a valid option.");
        return;
      }
      displayOutfit();
    }
    function randomizeOutfit() {
      for (let part in outfit) {
        const options = partOptions[part];
        outfit[part] = options[Math.floor(Math.random() * options.length)];
      }
      displayOutfit();
    }
    function savePreset() {
      const name = prompt('Enter a name for this outfit preset:');
      if (name) {
        presets.push({ name, outfit: { ...outfit }, photos: { ...outfitPhotos } });
        persistPresets();
        updatePresetList();
      }
    }
    function updatePresetList() {
      const ul = document.getElementById('presetList');
      ul.innerHTML = '';
      presets.forEach((preset, idx) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span style="flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${preset.name}</span>
          <button class="preset-action-btn" aria-label="Load preset ${preset.name}" title="Load preset" onclick="loadPreset(${idx})">⏎</button>
          <button class="preset-action-btn" aria-label="Delete preset ${preset.name}" title="Delete preset" onclick="deletePreset(${idx})">🗑</button>
        `;
        ul.appendChild(li);
      });
    }
    function loadPreset(idx) {
      if (presets[idx]) {
        outfit = { ...presets[idx].outfit };
        outfitPhotos = { ...presets[idx].photos };
        displayOutfit();
        displayPhotos();
      }
    }
    function deletePreset(idx) {
      if (confirm(`Delete preset "${presets[idx].name}"?`)) {
        presets.splice(idx, 1);
        persistPresets();
        updatePresetList();
      }
    }
    function displayOutfit() {
      document.querySelectorAll('.outfit-label').forEach(el => el.remove());
      const container = document.querySelector('.human-container');
      const labelMap = {
        head: { class: 'label-head', val: outfit.head },
        upper: { class: 'label-upper', val: outfit.upper },
        legs: { class: 'label-legs', val: outfit.legs },
        feet: { class: 'label-feet', val: outfit.feet }
      };
      Object.entries(labelMap).forEach(([part, {class: cls, val}]) => {
        if (val) {
          const span = document.createElement('span');
          span.className = `outfit-label ${cls}`;
          span.textContent = val;
          container.appendChild(span);
        }
      });
    }
    // On load
    loadPresets();
    updatePresetList();
    displayOutfit();
    displayPhotos();
    window.addEventListener('beforeunload', () => {
      localStorage.setItem('currentOutfit', JSON.stringify(outfit));
      localStorage.setItem('currentPhotos', JSON.stringify(outfitPhotos));
    });
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('currentOutfit');
      const savedPhotos = localStorage.getItem('currentPhotos');
      if (saved) {
        try {
          outfit = JSON.parse(saved);
          displayOutfit();
        } catch(e){}
      }
      if (savedPhotos) {
        try {
          outfitPhotos = JSON.parse(savedPhotos);
          displayPhotos();
        } catch(e){}
      }
    });
  </script>
</body>
</html>